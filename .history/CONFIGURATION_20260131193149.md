# Atmos Configuration Guide

## Environment Variables Setup

### Backend Server Configuration (server/.env)

```bash
# Server Port
PORT=5000

# MongoDB Connection String
# Local: mongodb://localhost:27017/atmos
# Atlas: mongodb+srv://username:password@cluster.mongodb.net/atmos?retryWrites=true&w=majority
MONGODB_URI=mongodb://localhost:27017/atmos

# JWT Secret for token signing - CHANGE THIS IN PRODUCTION!
JWT_SECRET=your_super_secret_jwt_key_change_this_in_production

# Environment Mode
NODE_ENV=development
```

### Frontend Configuration (client/.env)

```bash
# Backend API URL
REACT_APP_API_URL=http://localhost:5000

# Socket.io Server URL
REACT_APP_SOCKET_IO_URL=http://localhost:5000
```

## Database Setup

### Option 1: Local MongoDB

1. **Install MongoDB**
   - Windows: Download from https://www.mongodb.com/try/download/community
   - macOS: `brew tap mongodb/brew && brew install mongodb-community`
   - Linux: Follow official MongoDB installation guide

2. **Start MongoDB**
   ```bash
   # Windows - MongoDB Compass GUI is easiest
   # Or command line:
   mongod --dbpath "C:\data\db"
   
   # macOS/Linux:
   mongod
   ```

3. **Verify Connection**
   ```bash
   mongo
   # Should connect to local MongoDB
   ```

### Option 2: MongoDB Atlas (Cloud)

1. **Create Atlas Account**
   - Go to https://www.mongodb.com/cloud/atlas
   - Sign up for free account
   - Create a new project

2. **Create Database Cluster**
   - Choose shared cluster (free tier)
   - Select region closest to you
   - Create cluster

3. **Get Connection String**
   - Go to "Connect"
   - Choose "Connect Your Application"
   - Copy connection string
   - Update `.env` MONGODB_URI with:
   ```
   mongodb+srv://username:password@cluster.mongodb.net/atmos?retryWrites=true&w=majority
   ```

4. **Create Database User**
   - Set username and password
   - Add connection from any IP (0.0.0.0/0) for development

## JWT Secret Generation

### Generate Secure JWT Secret

```bash
# Using Node.js
node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"

# Output example:
# a7c42b5f8d9e2c4b1a3f5e7d9b2c4a6e8f1d3b5c7e9a1f3d5b7c9e1f3a5b7

# Use this in your .env JWT_SECRET
```

## Port Configuration

### Default Ports
- **Backend**: 5000
- **Frontend**: 3000
- **MongoDB**: 27017 (local)

### Custom Ports

**Change backend port:**
```bash
# In server/.env
PORT=8000
```

**Change frontend port:**
```bash
# In client/package.json, add to scripts:
"start": "PORT=3001 react-scripts start"
```

## Socket.io Configuration

### CORS Settings (Already Configured)

Located in `server/src/index.js`:
```javascript
const io = socketio(server, {
  cors: {
    origin: 'http://localhost:3000',
    methods: ['GET', 'POST'],
  },
});
```

### For Production CORS:
```javascript
cors: {
  origin: ['https://yourdomain.com', 'https://app.yourdomain.com'],
  methods: ['GET', 'POST'],
  credentials: true
}
```

## Database Seeding

### Seed Test Data

```bash
cd server
node seed.js
```

### What Gets Seeded
- 4 test users (Manager, Employee, Employee, Admin)
- 1 test team
- 2 sample kudos
- 4 sample pulse checks
- 2 sample Q&A questions

### Test Credentials
```
Manager:  manager@test.com / test123
Employee: employee1@test.com / test123
Employee: employee2@test.com / test123
Admin:    admin@test.com / test123
```

## Production Configuration

### Before Deploying to Production

1. **Change JWT Secret**
   ```bash
   JWT_SECRET=<generate-new-secure-secret>
   ```

2. **Set Environment**
   ```
   NODE_ENV=production
   ```

3. **Configure MongoDB Atlas**
   - Use production cluster
   - Enable authentication
   - Restrict IP addresses

4. **Update CORS Origins**
   - Only allow your domain
   - Use HTTPS URLs only

5. **Enable HTTPS**
   - Get SSL certificate
   - Configure server for HTTPS
   - Update client URLs to https://

### Heroku Deployment

1. **Set Environment Variables**
   ```bash
   heroku config:set JWT_SECRET=<your-secret>
   heroku config:set MONGODB_URI=<your-atlas-uri>
   heroku config:set NODE_ENV=production
   ```

2. **Deploy**
   ```bash
   git push heroku main
   ```

### Vercel/Netlify Deployment (Frontend)

1. **Set Environment Variables in Dashboard**
   - REACT_APP_API_URL=https://your-api.herokuapp.com
   - REACT_APP_SOCKET_IO_URL=https://your-api.herokuapp.com

2. **Deploy**
   - Connect GitHub repo
   - Auto-deploys on push to main

## Database Backups

### MongoDB Atlas Automatic Backups
- Enabled by default
- Keeps snapshots every 12 hours
- 7-day retention

### Manual Backup (Local MongoDB)

```bash
# Dump database
mongodump --db atmos --out ./backups/atmos-backup

# Restore database
mongorestore --db atmos ./backups/atmos-backup/atmos
```

## Monitoring & Debugging

### View MongoDB Data

```bash
# Connect to MongoDB
mongo

# Select database
use atmos

# View collections
show collections

# Query data
db.users.find()
db.kudos.find()
db.pulse.find()
db.questions.find()
```

### Monitor Socket.io Events

In browser console:
```javascript
// Check Socket.io connection
io.on('*', (event, ...args) => {
  console.log('Socket.io event:', event, args);
});
```

### Check API Requests

- Open browser DevTools
- Go to "Network" tab
- Filter by "XHR" or "Fetch"
- Check Authorization header contains Bearer token

## Troubleshooting Configuration Issues

### "Cannot connect to MongoDB"
```bash
# Check MongoDB is running
mongod --version

# Check connection string in .env
# Verify database name matches
# For Atlas: make sure IP is whitelisted
```

### "Socket.io connection refused"
```bash
# Check backend is running on port 5000
# Verify CORS origin matches frontend URL
# Check Socket.io URL in client .env
```

### "JWT token invalid"
```bash
# Clear localStorage in browser
localStorage.clear()

# Re-login to get new token
# Check JWT_SECRET is same on server
```

### "Port already in use"
```bash
# Find process using port
netstat -ano | findstr :5000  # Windows
lsof -i :5000                 # macOS/Linux

# Kill process
taskkill /PID <PID> /F        # Windows
kill -9 <PID>                 # macOS/Linux

# Or change port in .env
```

## Security Best Practices

1. **Secrets Management**
   - Never commit .env files
   - Use environment variables in production
   - Rotate JWT_SECRET periodically

2. **Database Security**
   - Enable MongoDB authentication
   - Use strong passwords
   - Restrict IP addresses on Atlas
   - Enable encryption at rest

3. **API Security**
   - Enable HTTPS only
   - Implement rate limiting
   - Validate all inputs
   - Use CORS properly
   - Add request timeout

4. **Frontend Security**
   - Sanitize user inputs
   - Store token securely
   - Validate token expiration
   - Clear auth on logout

## Performance Optimization

### Database Indexes

```javascript
// Already set in models, add more as needed:
userSchema.index({ email: 1 });
teamSchema.index({ managerId: 1 });
kudosSchema.index({ teamId: 1, createdAt: -1 });
pulseSchema.index({ teamId: 1, createdAt: -1 });
questionSchema.index({ sessionId: 1, upvotes: -1 });
```

### Caching Strategy
- Cache team data after fetch
- Cache aggregated pulse data
- Use localStorage for UI state
- Implement Redis for distributed caching

### Database Query Optimization
- Paginate large result sets
- Use projection to limit fields
- Archive old data
- Monitor slow queries

## Additional Resources

- **MongoDB Documentation**: https://docs.mongodb.com/
- **Mongoose Documentation**: https://mongoosejs.com/
- **Express.js Guide**: https://expressjs.com/
- **Socket.io Documentation**: https://socket.io/docs/
- **React Documentation**: https://react.dev/
- **JWT.io**: https://jwt.io/

---

Last Updated: 2026-01-31
