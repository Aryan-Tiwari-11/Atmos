# Atmos Development Guide

## Quick Start Commands

### Terminal 1 - Backend
```bash
cd server
npm install
npm run dev
```

### Terminal 2 - Frontend
```bash
cd client
npm install
npm start
```

## Testing the Application

### 1. Create Test Accounts
- Register as a Manager: 
  - Name: John Manager
  - Email: manager@test.com
  - Password: test123
  - Role: Manager

- Register as an Employee:
  - Name: Jane Employee
  - Email: employee@test.com
  - Password: test123
  - Role: Employee

### 2. Test Kudos Feature
1. Login as Employee
2. Navigate to "Kudos Feed"
3. Fill in form with manager's user ID
4. Submit kudos - should appear in feed
5. Open second browser window as different user to see real-time update

### 3. Test Pulse Check
1. Click "Pulse Check"
2. Select mood (Light, Good, Heavy)
3. Add optional notes
4. Submit

### 4. Test Manager Dashboard
1. Login as Manager
2. Navigate to "Team Dashboard"
3. Watch live updates as other users submit pulse checks
4. Chart updates in real-time

### 5. Test Q&A Feature
1. Login as any user
2. Navigate to "Q&A"
3. Submit a question
4. Upvote in other window
5. See upvote count update in real-time

## Database Setup

### Local MongoDB
```bash
# Windows - start MongoDB service
mongod

# Or use MongoDB Compass for GUI management
```

### MongoDB Atlas (Cloud)
Update `.env` MONGODB_URI:
```
MONGODB_URI=mongodb+srv://username:password@cluster.mongodb.net/atmos
```

## Debugging Tips

### Check Socket.io Connection
Open browser console:
```javascript
// In browser console
if (window.io) {
  console.log('Socket.io loaded');
  const socket = io('http://localhost:5000');
}
```

### Check API Requests
Use browser Network tab to inspect:
- Token in Authorization header
- Response data structure
- WebSocket messages

### MongoDB Connection
```bash
# Connect to local MongoDB
mongo
use atmos
db.users.find()
```

## Common Issues & Solutions

### "Cannot GET /api/auth/login"
- Server not running on port 5000
- Check if backend server started with `npm run dev`

### "WebSocket is closed"
- Socket.io server not running
- Check CORS in server/src/index.js

### "No token, authorization denied"
- Token not stored in localStorage
- Re-login required

### "MongoDB connection error"
- MongoDB service not running
- Check connection string in .env

## Environment Variables Reference

### Server (.env)
```
PORT=5000                                    # Server port
MONGODB_URI=mongodb://localhost:27017/atmos  # MongoDB connection
JWT_SECRET=your_secure_secret_key           # JWT signing secret
NODE_ENV=development                        # Environment
```

### Client (.env)
```
REACT_APP_API_URL=http://localhost:5000     # Backend API URL
REACT_APP_SOCKET_IO_URL=http://localhost:5000 # Socket.io server
```

## Project Structure Details

### Backend Models
- **User**: Stores user accounts, roles, team assignments
- **Team**: Team management with members list
- **Kudos**: Kudos messages with sender/receiver info
- **Pulse**: Pulse check submissions with status
- **Question**: Q&A questions with upvotes

### Frontend Components Hierarchy
```
App
├── AuthProvider (context)
├── Router
│   ├── Login
│   ├── Register
│   └── ProtectedRoute
│       └── Dashboard
│           ├── KudosFeed
│           ├── PulseModal
│           ├── ManagerDashboard
│           └── QAComponent
```

### Socket.io Rooms Pattern
- `company-feed_{teamId}` - Kudos & general feed
- `manager-dashboard_{teamId}` - Pulse updates for manager
- `qa-session_{sessionId}` - Q&A session updates

## API Response Format

### Success Response
```json
{
  "data": { /* response data */ },
  "message": "Success"
}
```

### Error Response
```json
{
  "message": "Error description",
  "error": "Detailed error"
}
```

### Token Response
```json
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "user": {
    "id": "user_id",
    "name": "User Name",
    "email": "user@email.com",
    "role": "Employee"
  }
}
```

## Performance Tips

1. **Use indexed queries** - MongoDB indexes on frequently queried fields
2. **Limit real-time updates** - Throttle Socket.io broadcasts
3. **Cache team data** - Reduce repeated API calls
4. **Pagination** - For large kudos/question feeds
5. **Database optimization** - Monitor query performance

## Security Checklist

- [ ] Change JWT_SECRET before production
- [ ] Enable MongoDB authentication
- [ ] Use HTTPS URLs
- [ ] Implement request rate limiting
- [ ] Validate all inputs server-side
- [ ] Use secure password hashing (bcryptjs)
- [ ] Implement CORS properly
- [ ] Add request timeout limits
- [ ] Sanitize user inputs
- [ ] Log security events

## Production Deployment

### Server (Heroku example)
1. Set environment variables on Heroku
2. Connect MongoDB Atlas
3. Deploy with `git push heroku main`

### Frontend (Vercel/Netlify)
1. Set environment variables
2. Connect GitHub repo
3. Auto-deploy on push

## Additional Resources

- Socket.io Docs: https://socket.io/docs/
- Express Docs: https://expressjs.com/
- React Docs: https://react.dev/
- MongoDB Docs: https://docs.mongodb.com/
- Chart.js Docs: https://www.chartjs.org/
